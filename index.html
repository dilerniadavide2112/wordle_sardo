<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Wordle Sardo</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#111;
  color:#eee;
  display:flex;
  justify-content:center;
}

.container {
  margin-top:30px;
  text-align:center;
  width:95vw;
  max-width:500px;
  position:relative;
}

h1 { letter-spacing:0.3em; margin-bottom:20px; }

.row { display:flex; justify-content:center; }

.cell {
  flex:1 1 18%;
  min-width:40px;
  max-width:60px;
  aspect-ratio:1/1;
  border:2px solid #333;
  margin:3px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  font-weight:600;
  text-transform:uppercase;
}

.correct { background:#538d4e; border-color:#538d4e; }
.present { background:#b59f3b; border-color:#b59f3b; }
.absent  { background:#3a3a3c; border-color:#3c3c3c; }

.overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10;
}

.show { display:flex; }

.modal {
  background:#222;
  padding:25px;
  border-radius:12px;
  max-width:90%;
  max-height:80vh;
  overflow:hidden;
  text-align:center;
}

.modal-scroll {
  text-align:left;
  overflow-y:auto;
  max-height:50vh;
  padding-right:10px;
  margin-bottom:15px;
  line-height:1.4;
}

button {
  padding:10px 20px;
  margin:8px;
  font-size:16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.primary { background:#538d4e; color:#fff; }
.secondary { background:#555; color:#fff; }

#keyboardInput {
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  height:40px;
  opacity:0.01;
}
</style>
</head>

<body>

<!-- MENU INIZIALE -->
<div id="startOverlay" class="overlay show">
  <div class="modal">
    <h2>WORDLE SARDO</h2>
    <button class="primary" id="startPlay">GIOCA</button>
    <button class="secondary" id="openRules">REGOLE</button>
  </div>
</div>

<!-- REGOLE -->
<div id="rulesOverlay" class="overlay">
  <div class="modal">
    <h2>REGOLE</h2>

    <div class="modal-scroll">
      <p>Indovina sa parola de 5 letras in 6 tentativos.</p>
      <p>Ogni tentativu depet Ã¨ssere una parola valida in sardu.</p>
      <p>Dopu ogni tentativu:</p>
      <ul>
        <li>ðŸŸ© letra giusta e in postu giustu</li>
        <li>ðŸŸ¨ letra giusta ma in postu sbagliadu</li>
        <li>â¬› letra chi non est in sa parola</li>
      </ul>
      <p>Sa parola est sa matessi pro totu in sa die.</p>
      <p>No si podet riprovare finzas a crasi.</p>
    </div>

    <button class="primary" id="rulesOk">OK, GIOCA</button>
  </div>
</div>

<!-- FINE PARTITA -->
<div id="overlay" class="overlay">
  <div class="modal">
    <h2 id="result"></h2>
    <pre id="solution"></pre>
    <button class="primary" id="shareBtn">Condividi</button>
    <button class="secondary" id="closeBtn">Chiudi</button>
  </div>
</div>

<div class="container">
  <h1>WORDLE SARDO</h1>
  <div id="game"></div>
  <input id="keyboardInput" type="text" maxlength="5"
    autocorrect="off" autocomplete="off" spellcheck="false">
</div>

<script>
/* ===== BLOCCO GIOCO FINCHÃ‰ NON SI PREME GIOCA ===== */
let gameEnabled = false;

document.getElementById("startPlay").onclick = () => {
  document.getElementById("startOverlay").classList.remove("show");
  gameEnabled = true;
};

document.getElementById("openRules").onclick = () => {
  document.getElementById("rulesOverlay").classList.add("show");
};

document.getElementById("rulesOk").onclick = () => {
  document.getElementById("rulesOverlay").classList.remove("show");
  document.getElementById("startOverlay").classList.remove("show");
  gameEnabled = true;
};

/* ===== QUI SOTTO IL TUO GIOCO, INALTERATO ===== */

const WORDS = ["cantu","terra","limba","domus","abbae","bentu"];

const epoch = new Date(2023,0,1);
const dayIndex = Math.floor((Date.now()-epoch)/86400000);
const solution = WORDS[dayIndex % WORDS.length];
const storageKey = "wordle-sardo-"+dayIndex;

const maxRows = 6;
const game = document.getElementById("game");
let currentRow = 0;
let currentGuess = "";
let guesses = [];

const rows = [];
for(let r=0;r<maxRows;r++){
  const row=document.createElement("div");
  row.className="row";
  const cells=[];
  for(let c=0;c<5;c++){
    const cell=document.createElement("div");
    cell.className="cell";
    row.appendChild(cell);
    cells.push(cell);
  }
  game.appendChild(row);
  rows.push(cells);
}

function renderGuess(guess){
  const solArr = solution.split("");
  const count = {};
  solArr.forEach(c=>count[c]=(count[c]||0)+1);

  guess.split("").forEach((c,i)=>{
    const cell=rows[currentRow][i];
    cell.textContent=c;
    if(c===solArr[i]){
      cell.classList.add("correct");
      count[c]--;
    }
  });

  guess.split("").forEach((c,i)=>{
    const cell=rows[currentRow][i];
    if(cell.classList.contains("correct")) return;
    if(solArr.includes(c) && count[c]>0){
      cell.classList.add("present");
      count[c]--;
    } else cell.classList.add("absent");
  });

  guesses.push(guess);
  currentRow++;
}

function submitGuess(){
  if(!gameEnabled) return;
  if(currentGuess.length!==5) return;

  renderGuess(currentGuess);

  if(currentGuess===solution || currentRow>=maxRows){
    showEnd();
  }

  currentGuess="";
  input.value="";
}

function showEnd(){
  document.getElementById("result").textContent =
    currentGuess===solution ? "BRAVU" : "SPACCIAU";

  let text="";
  guesses.forEach((g,r)=>{
    for(let i=0;i<5;i++){
      const c=rows[r][i];
      text += c.classList.contains("correct")?"ðŸŸ©":
              c.classList.contains("present")?"ðŸŸ¨":"â¬›";
    }
    text+="\n";
  });

  window.shareText =
    "Wordle Sardo " + guesses.length + "/6\n\n" + text;

  document.getElementById("solution").textContent = text;
  document.getElementById("overlay").classList.add("show");
}

const input = document.getElementById("keyboardInput");

input.addEventListener("input",e=>{
  if(!gameEnabled) return;
  const v=e.target.value.toLowerCase().slice(0,5);
  currentGuess=v;
  for(let i=0;i<5;i++) rows[currentRow][i].textContent=v[i]||"";
});

input.addEventListener("keydown",e=>{
  if(e.key==="Enter") submitGuess();
});

document.getElementById("shareBtn").onclick=()=>{
  if(navigator.share){
    navigator.share({text:window.shareText});
  }
};

document.getElementById("closeBtn").onclick=()=>{
  document.getElementById("overlay").classList.remove("show");
};
</script>

</body>
</html>
