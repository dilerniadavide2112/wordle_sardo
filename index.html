<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wordle Sardo</title>
    <style>
        :root { --green: #538d4e; --yellow: #b59f3b; --gray: #3a3a3c; --black: #121213; --border: #3a3a3c; }
        body { background: var(--black); color: white; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        
        header { width: 100%; max-width: 500px; display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; border-bottom: 1px solid var(--border); box-sizing: border-box; }
        h1 { font-size: 24px; letter-spacing: 4px; margin: 0; }
        .icon-btn { background: none; border: none; color: white; font-size: 20px; cursor: pointer; }

        #board { display: grid; grid-template-rows: repeat(6, 1fr); grid-gap: 5px; width: 330px; height: 400px; margin: 20px 0; }
        .row { display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px; }
        .cell { border: 2px solid var(--border); display: flex; justify-content: center; align-items: center; font-size: 2rem; font-weight: bold; text-transform: uppercase; transition: transform 0.1s; }
        .cell.pop { transform: scale(1.1); }

        .keyboard { width: 100%; max-width: 500px; padding: 10px; box-sizing: border-box; }
        .kb-row { display: flex; justify-content: center; margin-bottom: 8px; }
        .key { background: #818384; color: white; border: 0; border-radius: 4px; margin: 0 3px; height: 58px; flex: 1; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 14px; user-select: none; }
        .key.wide { flex: 1.5; font-size: 12px; }

        .correct { background: var(--green) !important; border-color: var(--green); }
        .present { background: var(--yellow) !important; border-color: var(--yellow); }
        .absent { background: var(--gray) !important; border-color: var(--gray); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 100; }
        .modal { background: #1e1e1e; padding: 25px; border-radius: 15px; text-align: center; width: 85%; max-width: 400px; border: 1px solid var(--border); }
        .show { display: flex; }
        
        .stat-bar { display: flex; justify-content: space-around; margin: 20px 0; }
        .stat-item { display: flex; flex-direction: column; }
        .stat-val { font-size: 24px; font-weight: bold; }
        .stat-lbl { font-size: 10px; text-transform: uppercase; }

        .share-btn { background: var(--green); color: white; border: none; width: 100%; padding: 15px; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 18px; margin-top: 15px; }
    </style>
</head>
<body>

<header>
    <button class="icon-btn" onclick="toggleModal('rules-modal')">‚ùì</button>
    <h1>WORDLE SARDO</h1>
    <button class="icon-btn" onclick="showStatsModal()">üìä</button>
</header>

<div id="board"></div>

<div class="keyboard">
    <div class="kb-row" id="row1"></div>
    <div class="kb-row" id="row2"></div>
    <div class="kb-row" id="row3"></div>
</div>

<div id="stats-modal" class="overlay">
    <div class="modal">
        <h2 id="res-title"></h2>
        <p id="judgment" style="color:var(--yellow); font-size: 1.2rem; font-weight: bold;"></p>
        <div class="stat-bar">
            <div class="stat-item"><span class="stat-val" id="st-played">0</span><span class="stat-lbl">Giocate</span></div>
            <div class="stat-item"><span class="stat-val" id="st-win">0</span><span class="stat-lbl">% Vinte</span></div>
            <div class="stat-item"><span class="stat-val" id="st-streak">0</span><span class="stat-lbl">Streak</span></div>
        </div>
        <p id="sol-reveal"></p>
        <button class="share-btn" id="share-btn">CONDIVIDI ‚ûî</button>
        <button onclick="toggleModal('stats-modal')" style="background:none; border:none; color:#aaa; margin-top:15px; cursor:pointer;">Chiudi</button>
    </div>
</div>

<script>
// Usa l'array completo WORDS dal tuo originale
const WORDS = ["cantu","terra","limba","domus","abbae","abbas","agusu","akatu","amore","annos","arras","artu","asinu","attzu","bacca","ballu","battu","berru","bidda","binu","boghe","bonu","braxu","bussu","cabbu","caded","camin","campu","canes","capru","carri","ceddu","chelu","chena","chida","chidu","coggi","conca","corru","costa","craba","crobu","cuadu","curre","dente","dinai","dridu","fangu","fattu","femmu","ferro","figus","filu","foghe","forru","fradi","frori","fundu","gattu","genna","giara","goccu","granu","herra","ibidu","istru","latte","legnu","libru","littu","logu","macas","manus","mattu","melis","menta","merca","metru","missa","molle","monte","moru","mughe","nassa","niedu","ninnu","nuddu","olivu","omini","orru","pane","pedde","perda","pietu","pilus","pinna","pitzus","planu","ponte","porru","pratu","prenu","punta","putzu","rabbu","randa","rattu","riccu","rimas","rinnu","rocca","roghe","rueda","sabba","santu","sartu","sedda","serra","siddu","sinnu","solee","sonnu","spina","stadu","stolu","suddu","tabba","tanca","tattu","terru","tissu","torru","trigu","umbra","undas","ungra","usciu","vacca","valle","vesta","vidda","vinu","virga","zente","zinnu","bentu"];

const epoch = new Date(2023, 0, 1);
const dayIndex = Math.floor((Date.now() - epoch) / 86400000);
const solution = WORDS[dayIndex % WORDS.length];
const storageKey = "wordle-sardo-" + dayIndex;

let currentRow = 0, currentCol = 0, currentGuess = "", guesses = [], gameOver = false;

// Genera board
const board = document.getElementById("board");
for(let i=0; i<30; i++) {
    const cell = document.createElement("div"); cell.className = "cell";
    cell.id = "c-"+i; board.appendChild(cell);
}

// Genera Tastiera
const kb = [['q','w','e','r','t','y','u','i','o','p'],['a','s','d','f','g','h','j','k','l'],['ENTER','z','x','c','v','b','n','m','DEL']];
kb.forEach((r, i) => {
    const rowDiv = document.getElementById("row"+(i+1));
    r.forEach(k => {
        const b = document.createElement("button"); b.textContent = k;
        b.className = "key" + (k.length > 1 ? " wide" : "");
        b.id = "k-"+k.toLowerCase();
        b.onclick = () => handleKey(k);
        rowDiv.appendChild(b);
    });
});

function handleKey(k) {
    if(gameOver) return;
    if(k === "ENTER") submitGuess();
    else if(k === "DEL") deleteLetter();
    else if(currentGuess.length < 5 && /^[a-z]$/i.test(k)) addLetter(k.toLowerCase());
}

function addLetter(l) {
    currentGuess += l;
    const cell = document.getElementById("c-"+(currentRow*5 + currentCol));
    cell.textContent = l; cell.classList.add("pop");
    setTimeout(()=>cell.classList.remove("pop"), 100);
    currentCol++;
}

function deleteLetter() {
    if(currentCol <= 0) return;
    currentCol--; currentGuess = currentGuess.slice(0,-1);
    document.getElementById("c-"+(currentRow*5 + currentCol)).textContent = "";
}

function submitGuess() {
    if(currentGuess.length !== 5) return;
    if(!WORDS.includes(currentGuess)) { alert("Parola non in elenco!"); return; }

    const rowStart = currentRow * 5;
    const solArr = solution.split("");
    const guessArr = currentGuess.split("");
    
    // Primo passaggio: Verdi
    guessArr.forEach((l, i) => {
        const cell = document.getElementById("c-"+(rowStart+i));
        const key = document.getElementById("k-"+l);
        if(l === solArr[i]) {
            cell.classList.add("correct");
            key.className = "key correct";
            solArr[i] = null;
        }
    });

    // Secondo passaggio: Gialli/Grigi
    guessArr.forEach((l, i) => {
        const cell = document.getElementById("c-"+(rowStart+i));
        if(cell.classList.contains("correct")) return;
        const key = document.getElementById("k-"+l);
        if(solArr.includes(l)) {
            cell.classList.add("present");
            if(!key.classList.contains("correct")) key.className = "key present";
            solArr[solArr.indexOf(l)] = null;
        } else {
            cell.classList.add("absent");
            if(!key.classList.contains("correct") && !key.classList.contains("present")) key.className = "key absent";
        }
    });

    guesses.push(currentGuess);
    localStorage.setItem(storageKey, JSON.stringify(guesses));

    if(currentGuess === solution) endGame(true);
    else if(currentRow === 5) endGame(false);
    else { currentRow++; currentCol = 0; currentGuess = ""; }
}

function endGame(win) {
    gameOver = true;
    updateStats(win);
    setTimeout(() => showStatsModal(win), 1000);
}

function updateStats(win) {
    let s = JSON.parse(localStorage.getItem("wordle-sardo-stats")) || { giocate:0, vinte:0, streak:0 };
    if(!localStorage.getItem(storageKey+"-done")) {
        s.giocate++; if(win) { s.vinte++; s.streak++; } else { s.streak = 0; }
        localStorage.setItem("wordle-sardo-stats", JSON.stringify(s));
        localStorage.setItem(storageKey+"-done", "1");
    }
}

function showStatsModal(win = null) {
    const s = JSON.parse(localStorage.getItem("wordle-sardo-stats")) || { giocate:0, vinte:0, streak:0 };
    document.getElementById("st-played").textContent = s.giocate;
    document.getElementById("st-win").textContent = s.giocate ? Math.round((s.vinte/s.giocate)*100) : 0;
    document.getElementById("st-streak").textContent = s.streak;
    
    if(win !== null) {
        document.getElementById("res-title").textContent = win ? "BRAVU! üî•" : "PECCAU! üíÄ";
        document.getElementById("judgment").textContent = win ? (guesses.length <= 2 ? "sei fortissimu üî•" : "forte sei üí™") : "scarso sei üòà";
    }
    document.getElementById("sol-reveal").textContent = "La parola era: " + solution.toUpperCase();
    toggleModal("stats-modal");
}

function toggleModal(id) {
    const m = document.getElementById(id);
    m.style.display = (m.style.display === "flex") ? "none" : "flex";
}

document.getElementById("share-btn").onclick = () => {
    let text = `Wordle Sardo #${dayIndex} ${gameOver && guesses.includes(solution) ? guesses.length : "X"}/6\n\n`;
    guesses.forEach(g => {
        // Logica emoji...
    });
    if(navigator.share) navigator.share({text: text});
};

window.onkeydown = (e) => handleKey(e.key.toUpperCase());
</script>
</body>
</html>
