<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Wordle Sardo</title>
<style>
body { font-family: system-ui, sans-serif; background:#111; color:#eee; display:flex; justify-content:center; }
.container { margin-top:30px; text-align:center; width:95vw; max-width:500px; position:relative; }
h1 { letter-spacing:0.3em; margin-bottom:20px; }
.row { display:flex; justify-content:center; }
.cell { flex:1 1 18%; min-width:40px; max-width:60px; height:auto; aspect-ratio:1/1; border:2px solid #333; margin:3px; display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:600; text-transform:uppercase; }
.correct { background:#538d4e; border-color:#538d4e; }
.present { background:#b59f3b; border-color:#b59f3b; }
.absent { background:#3a3a3c; border-color:#3c3c3c; }
@keyframes pop {0%{transform:scale(0.8);opacity:0}100%{transform:scale(1);opacity:1}}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;}
.modal{background:#222;padding:30px;border-radius:12px;animation:pop .3s ease-out;text-align:center;white-space:pre-line;}
.modal h2{letter-spacing:.2em;margin-bottom:10px;}
.show{display:flex;}
#keyboardInput{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:90%;height:40px;opacity:0.01;font-size:24px;}
.shareBtn{margin-top:15px;padding:10px 20px;font-size:16px;border:none;border-radius:6px;background:#538d4e;color:#fff;cursor:pointer;}
.closeBtn{margin-top:10px;padding:5px 10px;font-size:14px;border:none;border-radius:6px;background:#555;color:#fff;cursor:pointer;}
</style>
</head>
<body>
<div class="container">
<h1>WORDLE SARDO</h1>
<div id="game"></div>
<input id="keyboardInput" type="text" maxlength="5" autocorrect="off" autocomplete="off" spellcheck="false">
</div>

<div id="overlay" class="overlay">
<div class="modal">
<h2 id="result"></h2>
<p id="solution"></p>
<p id="judgment"></p>
<button class="shareBtn" id="shareBtn">Condividi</button>
<button class="closeBtn" id="closeBtn">Chiudi</button>
</div>
</div>

<script>
const WORDS = ["cantu","terra","limba","domus","abbae","abbas","agusu","akatu",
"amore","annos","arras","artu","asinu","attzu","bacca","ballu","battu",
"berru","bidda","binu","boghe","bonu","braxu","bussu","cabbu","caded",
"camin","campu","canes","capru","carri","ceddu","chelu","chena","chida",
"chidu","coggi","conca","corru","costa","craba","crobu","cuadu","curre",
"dente","dinai","dridu","fangu","fattu","femmu","ferro","figus","filu",
"foghe","forru","fradi","frori","fundu","gattu","genna","giara","goccu",
"granu","herra","ibidu","istru","latte","legnu","libru","littu","logu",
"macas","manus","mattu","melis","menta","merca","metru","missa","molle",
"monte","moru","mughe","nassa","niedu","ninnu","nuddu","olivu","omini",
"orru","pane","pedde","perda","pietu","pilus","pinna","pitzus","planu",
"ponte","porru","pratu","prenu","punta","putzu","rabbu","randa","rattu",
"riccu","rimas","rinnu","rocca","roghe","rueda","sabba","santu","sartu",
"sedda","serra","siddu","sinnu","solee","sonnu","spina","stadu","stolu",
"suddu","tabba","tanca","tattu","terru","tissu","torru","trigu","umbra",
"undas","ungra","usciu","vacca","valle","vesta","vidda","vinu","virga",
"zente","zinnu","bentu","abbae","abbas","abidu","acqua","addiu","agudu","aiadu","ajudu","alidu","altu","amadu","amare","ambra","annos","ansia","apriu","aridu","arras","artu","asinu","attzu","auras","azotu",
               "bacas","bagna","ballu","battu","beidu","bentu","berru","bidda","binu","boghe","bonu","braxu","bravu","bussu","cabbu","caded","camin","campu","canes","capru","carri","ceddu","chelu","chena",
               "chida","chidu","coggi","coldu","conca","corru","costa","craba","crobu","cuadu","curre","dente","dinai","domus","dridu","durus","fache","fangu","fattu","femmu","ferro","figus","filu","foghe",
               "forru","fradi","fridu","frori","fundu","gattu","genna","giara","goccu","granu","herra","ibidu","imidu","istru","lattu","latte","legnu","libru","littu","logu","luciu","macas","maled","manus",
               "mariu","mattu","melis","menta","merca","metru","missa","moddu","molle","monte","moru","mughe","nassa","niedu","ninnu","nuddu","olivu","omini","orrua","ossu","paber","panee","pannu","pedde",
               "perda","pesca","piana","pietu","pilus","pinna","pintu","pitzus","planu","ponte","porru","pratu","prenu","punta","putzu","rabbu","randa","rattu","regnu","riccu","rimas","rinnu","rocca","roghe",
               "rueda","sabba","santu","sartu","sedda","serra","siddu","sinnu","solee","sonnu","spada","spina","stadu","stolu","suddu","tabba","tanca","tattu","tenre","terru","tissu","torru","trigu","umbra",
               "undas","ungra","usciu","vacua","vacca","valle","vesta","vidda","vinu","virga","zente","zinnu","zoccu","abbidu","abbaru","abeta","abidu","abinu","accas","acidu","acutu","agidu","ajuru","alenu",
               "alidu","amada","amidu","anniu","apidu","aratu","ardiu","aridu","arriu","aspre","attiu","augas","bagna","baldu","balia","barca","bentu","bidas","bighe","bionu","boidu","bolla","branu","brida",
               "brutu","cabra","cairu","caldu","cantu","carbu","caria","casca","cattu","cennu","chena","cibru","coddu","cortu","cress","cuasi","curdu","dannu","deidu","dertu","doble","doltu","draga","durra",
               "faina","fattu","feddu","filla","finas","fitta","flori","foras","fremu","fridu","fundu","gabbu","galdu","garbu","gattu","ghidu","giogu","gradu","ibadu","impon","incas","infiu","intre","isola",
               "istau","laduu","lamas","lassu","lentu","limba","linna","littu","lobiu","luddu","lumen","macas","madru","malas","manca","mardu","mascu","matta","meldu","mentu","mesti","millu","modda","mundu",
               "murta","nassa","niedu","noddu","noras","notte","ogliu","omadu","onore","opidu","orosu","ossia","paber","pagae","palas","pandu","parru","pattu","pedru","penna","pesas","pillu","pinna","piras",
               "poddu","poldu","prama","prena","puddu","puntu","raddu","ramas","randa","redda","rescu","riccu","rissu","rivas","robba","ruddu","sabba","sacru","saldu","sanas","sardu","seddu","senna","serru",
               "sessa","sibiu","simba","sinna","soddu","soldu","sonnu","spadu","stela","stidu","suddu","tanca","tardu","tella","tenni","terra","tinta","tittu","torra","tundu","turre","umbra","ungiu","usura",
               "vacua","vagus","valdu","varra","veddu","veldu","venna","verru","vidda","vigiu","virga","zinnu","zoccu","aberu","aeras","afidu","ainas","ainos","amigu","amore","ampru","andat","anima","antru",
               "aostu","arbus","arena","armas","artes","ascia","asulu","badde","banca","bannu","basca","bator","belus","benit","birde","borta","bosas","botru","brodu","bujiu","busta","caddu","calae","canna",
               "carga","carru","carta","casus","catza","cerva","chitu","cibus","cimas","cintu","codas","conto","coros","cosas","cozzu","crara","creja","crona","cruce","culos","cursu","custu","daret","datas",
               "deche","ditzu","dolos","donzi","dromi","duos","ebbas","erbas","faghu","fames","favas","festa","filas","fizos","fogus","folas","forte","funes","furas","fuste","ganas","gioia","giras","gomai",
               "gopai","gustu","janas","janna","josso","justu","lanas","lardu","largu","lebiu","lenas","lezes","linas","lizus","longu","luche","lunas","maccu","malus","mamas","mamma","mancu","maris","marra",
               "matas","meigu","melas","mesus","miras","modde","molas","moras","mudus","mulas","mulus","muras","murus","musca","muscu","narat","naris","nasus","neula","nosus","nughe","nuras","odius","olias",
               "ortus","ossas","ozzus","panis","paras","parte","passu","pazas","pedes","penas","perla","petza","pigat","pinta","pisci","pisus","pitzu","ponit","porcu","posta","pruna","pudda","pupas","ranas",
               "renas","resta","robas","rodas","rosas","ruius","sacca","salas","scala","scola","segat","segus","serus","siccu","sinus","sogas","sorus","sucus","taula","tazas","telas","tempu","tetas","tontu",
               "tostu","totus","tuvus","tzius","usat","vacas","vasat","vasus","velas","venas","vidas","visus","vitas","zassu","zegus","zelus","zerru","zestu","ziras","zonas","zuras"
              ];

const epoch=new Date(2023,0,1);
const dayIndex=Math.floor((Date.now()-epoch)/86400000);
const solution=WORDS[dayIndex%WORDS.length];
const storageKey="wordle-sardo-"+dayIndex;

const maxRows=6;
const game=document.getElementById("game");
let currentRow=0;
let currentGuess="";
let guesses=[];

const rows=[];
for(let r=0;r<maxRows;r++){
  const row=document.createElement("div");row.className="row";
  const cells=[];
  for(let c=0;c<5;c++){
    const cell=document.createElement("div");
    cell.className="cell";
    row.appendChild(cell);
    cells.push(cell);
  }
  game.appendChild(row);
  rows.push(cells);
}

const saved=localStorage.getItem(storageKey);
if(saved){
  const data=JSON.parse(saved);
  data.guesses.forEach(g=>renderGuess(g));
  const win = data.guesses[data.guesses.length-1]===solution;
  showOverlay(data.guesses.length, win);
}

const input=document.getElementById("keyboardInput");
document.querySelector(".container").addEventListener("click",()=>input.focus());

function renderGuess(guess){
  const solArr=solution.split("");
  const solCount={};
  solArr.forEach(ch=>solCount[ch]=(solCount[ch]||0)+1);

  guess.split("").forEach((ch,i)=>{
    const cell=rows[currentRow][i];
    cell.textContent=ch;
    if(ch===solArr[i]){
      cell.classList.add("correct");
      solCount[ch]--;
    }
  });

  guess.split("").forEach((ch,i)=>{
    const cell=rows[currentRow][i];
    if(cell.classList.contains("correct")) return;
    if(solArr.includes(ch)&&solCount[ch]>0){
      cell.classList.add("present");
      solCount[ch]--;
    } else {
      cell.classList.add("absent");
    }
  });

  guesses.push(guess);
  currentRow++;
}



function submitGuess(){
  if(currentGuess.length!==5 || currentRow>=maxRows) return;

  // Controllo se la parola Ã¨ nel dizionario
  if(!WORDS.includes(currentGuess)){
    alert("Parola non in elenco ðŸ˜…");
    return;
  }

  renderGuess(currentGuess);
  localStorage.setItem(storageKey, JSON.stringify({guesses}));
  
  if(currentGuess===solution) showOverlay(guesses.length, true);
  else if(currentRow>=maxRows) showOverlay(currentRow, false);

  currentGuess="";
  input.value="";
}


function giudizio(win, tentativi){
  if(!win) return "scarso sei ðŸ˜ˆ";
  if(tentativi<=2) return "sei fortissimu ðŸ”¥";
  if(tentativi<=4) return "forte sei ðŸ’ª";
  return "ti ses salvadu ðŸ˜…";
}
// ================= GESTIONE STATISTICHE =================

// recupera statistiche globali
function loadStats(){
  const s = localStorage.getItem("wordle-sardo-stats");
  if(!s){
    return {
      giocate:0,
      vinte:0,
      streak:0,
      maxStreak:0,
      tentativi:[0,0,0,0,0,0],
      perse:0
    };
  }
  return JSON.parse(s);
}

// salva stats
function saveStats(s){
  localStorage.setItem("wordle-sardo-stats", JSON.stringify(s));
}

// aggiorna dopo una partita
function updateStats(win, tentativi){
  const s = loadStats();

  s.giocate++;

  if(win){
    s.vinte++;
    s.streak++;
    if(s.streak > s.maxStreak) s.maxStreak = s.streak;

    // tentativi da 1 a 6 â†’ indice 0-5
    s.tentativi[tentativi-1]++;
  }else{
    s.perse++;
    s.streak = 0;
  }

  saveStats(s);
}

// crea testo carino delle stats
function statsText(){
  const s = loadStats();
  const perc = s.giocate ? Math.round((s.vinte/s.giocate)*100) : 0;

  let t = "";
  t += "ðŸ“Š STATISTICHE\n";
  t += "Giocate: " + s.giocate + "\n";
  t += "Vinte: " + s.vinte + " (" + perc + "%)\n";
  t += "Streak: " + s.streak + "\n";
  t += "Max streak: " + s.maxStreak + "\n\n";

  t += "Distribuzione tentativi:\n";
  for(let i=0;i<6;i++){
    t += (i+1) + ": " + s.tentativi[i] + "\n";
  }

  t += "Perse: " + s.perse;

  return t;
}

function showOverlay(tentativi, win){
  // AGGIORNAMENTO STATISTICHE SOLO SE NON ERA GIÃ€ SALVATA
  const keyDone = storageKey + "-done";
  if(!localStorage.getItem(keyDone)){
    updateStats(win, tentativi);
    localStorage.setItem(keyDone,"1");
  }

  // CONCATENA GIUDIZIO SUBITO DOPO BRAVU/SPACCIAU
  document.getElementById("result").textContent =
    (win ? "BRAVU!!ðŸ”¥" : "SPACCIAU!!ðŸ’€") + " â€” " + giudizio(win, tentativi);

  const score = win ? tentativi+"/6" : "X/6";
  document.getElementById("solution").textContent =
    "Parola: " + solution + "\nTentativi: " + score +
    "\n\n" + statsText(); // mostra le stats

  generateShareText(win, tentativi);
  document.getElementById("overlay").classList.add("show");
}


function generateShareText(win, tentativi){
  const score = win ? tentativi+"/6" : "X/6";
  const frase = giudizio(win, tentativi);

  let text="Wordle Sardo "+dayIndex+" "+score+"\n"+frase+"\n\n";

  guesses.forEach((g,ri)=>{
    for(let i=0;i<5;i++){
      const cell=rows[ri][i];
      if(cell.classList.contains("correct")) text+="ðŸŸ©";
      else if(cell.classList.contains("present")) text+="ðŸŸ¨";
      else text+="â¬›ï¸";
    }
    text+="\n";
  });

  window.shareText=text;
}

document.getElementById("shareBtn").addEventListener("click",()=>{
  if(navigator.share){
    navigator.share({text:window.shareText});
  } else {
    const url="https://api.whatsapp.com/send?text="+encodeURIComponent(window.shareText);
    window.open(url,"_blank");
  }
});

document.getElementById("closeBtn").addEventListener("click",()=>{
  document.getElementById("overlay").classList.remove("show");
});

input.addEventListener("input",e=>{
  const val=e.target.value.toLowerCase().slice(0,5);
  currentGuess=val;
  for(let i=0;i<5;i++) rows[currentRow][i].textContent=val[i]||"";
});

input.addEventListener("keydown",e=>{
  if(e.key==="Enter") submitGuess();
  else if(e.key==="Backspace"){
    currentGuess=currentGuess.slice(0,-1);
    rows[currentRow][currentGuess.length].textContent="";
  }
});

window.addEventListener("keydown",e=>{
  if(currentRow>=maxRows) return;
  if(e.key==="Enter") submitGuess();
  else if(e.key==="Backspace"){
    currentGuess=currentGuess.slice(0,-1);
    rows[currentRow][currentGuess.length].textContent="";
  }
  else if(/^[a-zA-Z]$/.test(e.key)&&currentGuess.length<5){
    const ch=e.key.toLowerCase();
    rows[currentRow][currentGuess.length].textContent=ch;
    currentGuess+=ch;
  }
});
</script>
</body>
</html>
